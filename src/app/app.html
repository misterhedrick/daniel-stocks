<mat-toolbar color="primary" class="toolbar">
  <div class="toolbar-left">
    <mat-icon>show_chart</mat-icon>
    <span class="title">Options Scanner</span>
  </div>

  <span class="spacer"></span>

  <button mat-raised-button color="accent" (click)="load()" [disabled]="loading()">
    <mat-icon>refresh</mat-icon>
    Refresh
  </button>
</mat-toolbar>

@if (loading()) {
  <mat-progress-bar mode="indeterminate"></mat-progress-bar>
}

<div class="container">
  @if (error()) {
    <mat-card class="error-card">
      <mat-card-title>Request failed</mat-card-title>
      <mat-card-content>{{ error() }}</mat-card-content>
    </mat-card>
  }

  @if (data(); as d) {
    <div class="cards">
      <mat-card>
        <mat-card-subtitle>Qualified tickers</mat-card-subtitle>
        <mat-card-title>{{ d.qualified_tickers | number }}</mat-card-title>
      </mat-card>

      <mat-card>
        <mat-card-subtitle>Min quality</mat-card-subtitle>
        <mat-card-title>{{ d.min_quality_score | number:'1.0-0' }}</mat-card-title>
      </mat-card>

      <mat-card>
        <mat-card-subtitle>Max Cost</mat-card-subtitle>
        <mat-card-title>{{ d.max_cost_per_contract | currency:'USD':'symbol':'1.2-2' }}</mat-card-title>
      </mat-card>
    </div>

    <div class="results-grid">
      @for (r of sortedResults(); track r.option_symbol) {
        <mat-card class="result-card mat-elevation-z1">
          <div class="result-header">
            <div class="ticker">{{ r.ticker }}</div>

            <div class="quality">
              <div class="quality-label">Quality</div>
              <div class="quality-value mono">{{ r.quality | number:'1.0-2' }}</div>
            </div>
          </div>

          <div class="result-meta">
            <mat-chip-set>
              <mat-chip [color]="chipColor(r.type)" selected>{{ r.type | uppercase }}</mat-chip>
            </mat-chip-set>

            <div class="exp mono">{{ r.expiration }}</div>
          </div>

          <div class="result-grid">
            <div class="kv">
              <div class="k muted">Strike</div>
              <div class="v mono">{{ r.strike | number:'1.0-2' }}</div>
            </div>

            <div class="kv">
              <div class="k muted">Bid</div>
              <div class="v mono">{{ r.bid | number:'1.2-2' }}</div>
            </div>

            <div class="kv">
              <div class="k muted">Ask</div>
              <div class="v mono">{{ r.ask | number:'1.2-2' }}</div>
            </div>

            <div class="kv">
              <div class="k muted">Mid</div>
              <div class="v mono">{{ r.mid | number:'1.2-2' }}</div>
            </div>
          </div>
        </mat-card>
      } @empty {
        <mat-card class="empty">
          <mat-card-title>No results</mat-card-title>
          <mat-card-content>
            The scan returned nothing qualified. Markets doing market things.
          </mat-card-content>
        </mat-card>
      }
    </div>
  } @else {
    <mat-card class="empty">
      <mat-card-title>Loadingâ€¦</mat-card-title>
      <mat-card-content>
        Scanning on page load.
      </mat-card-content>
    </mat-card>
  }
</div>
